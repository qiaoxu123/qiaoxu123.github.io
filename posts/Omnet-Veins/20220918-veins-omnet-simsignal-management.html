<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Category: Omnet-Veins | Blog</title><meta name="author" content="xqiao"><meta name="copyright" content="xqiao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Veins 的大框架是依赖 SUMO 提供实时的路网车流信息，简单点说就是需要实时更新车辆的位置。在 Veins 的 BaseMobility 模块中可以通过 TraCI 获取车辆的各种数据，但这个数据如何能够及时给到其他依赖于此的模块呢？答案应该是随处可见的 Signal（并非统计信息作用），就此探索并简单记录总结下。结合官方的文档（Veins 工程中）翻译总结。">
<meta property="og:type" content="article">
<meta property="og:title" content="结合 Veins 来看 Omnet 的 Signal 机制">
<meta property="og:url" content="http://qiaoxu123.github.io/posts/Omnet-Veins/20220918-veins-omnet-simsignal-management.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="Veins 的大框架是依赖 SUMO 提供实时的路网车流信息，简单点说就是需要实时更新车辆的位置。在 Veins 的 BaseMobility 模块中可以通过 TraCI 获取车辆的各种数据，但这个数据如何能够及时给到其他依赖于此的模块呢？答案应该是随处可见的 Signal（并非统计信息作用），就此探索并简单记录总结下。结合官方的文档（Veins 工程中）翻译总结。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://qiaoxu123.github.io/img/avatar.png">
<meta property="article:published_time" content="2022-09-18T09:45:17.000Z">
<meta property="article:modified_time" content="2023-12-02T11:40:39.804Z">
<meta property="article:author" content="xqiao">
<meta property="article:tag" content="经验总结">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qiaoxu123.github.io/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://qiaoxu123.github.io/posts/Omnet-Veins/20220918-veins-omnet-simsignal-management.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Category: Omnet-Veins',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-02 19:40:39'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/main.css"><meta name="generator" content="Hexo 7.0.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Blog"><span class="site-name">Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">结合 Veins 来看 Omnet 的 Signal 机制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-09-18T09:45:17.000Z" title="Created 2022-09-18 17:45:17">2022-09-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-12-02T11:40:39.804Z" title="Updated 2023-12-02 19:40:39">2023-12-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Omnet-Veins/">Omnet-Veins</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="结合 Veins 来看 Omnet 的 Signal 机制"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><p>首先应该从<code>receiveSignal</code>函数开始说起，既然说起 <code>receiveSignal</code> 那也一定要谈下其所属类 baseModule，关于其官方是这么介绍的</p>
<p><em><strong>Base class for all simple modules of a host</strong>. This method raises an error if the host state changes to something else than ACTIVE. Therefore that a sub-classing module can be used in a simulation where the host state can change it has to override that method which forces the author to make sure the module reacts well to host state changes.</em></p>
<p><em>Alternatively one can also set a “<code>notAffectedByHostState</code>” parameter of the module to true.  The base module additionally provides a function <code>findHost</code> which returns a pointer to the host module and a function hostIndex to return the index of the host module. The latter one correspondes to the index shown in tkenv and comes in very handy for testing and debugging using tkenv. It is used e.g. in all the ‘print’ macros used for debugging. There will never be a stand-alone BaseModule module.</em></p>
<p><em>Note: most modules wont derive from BaseModule directly but from its sub class “BatteryAccess” which extends BaseModule by several methods for accessing the battery module.</em></p>
<p>在其下实现了很多接口函数，其派生类里也调用其来注册订阅 signal，如应用层的 DemoBaseApplLayer，在 <code>initialize()</code> 函数的初始化中订阅了 mobility 消息和 parking 消息。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">findHost</span>()-&gt;<span class="built_in">subscribe</span>(BaseMobility::mobilityStateChangedSignal, <span class="keyword">this</span>);</span><br><span class="line"><span class="built_in">findHost</span>()-&gt;<span class="built_in">subscribe</span>(TraCIMobility::parkingStateChangedSignal, <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<p>之后继承了 BaseModule 中的 <code>receiveSignal</code> 函数并 override</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DemoBaseApplLayer::receiveSignal</span><span class="params">(cComponent* source, <span class="type">simsignal_t</span> signalID, cObject* obj, cObject* details)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Enter_Method_Silent</span>();</span><br><span class="line">    EV_INFO &lt;&lt; <span class="string">&quot;Run DemoBaseApplLayer::receiveSignal&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span> (signalID == BaseMobility::mobilityStateChangedSignal) &#123;</span><br><span class="line">        <span class="built_in">handlePositionUpdate</span>(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (signalID == TraCIMobility::parkingStateChangedSignal) &#123;</span><br><span class="line">        <span class="built_in">handleParkingUpdate</span>(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即只有收到 Basemobility::mobilityStateChangedSignal 信号后才进行位置的变动处理。</p>
<p>OMNet++ 在仿真中使用 Simulation Signals（或者 Signals）来实现 <strong>“发布-订阅”</strong> 机制。假设信号发送模块如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module emitting some signal whenever it receives a message (contrived example)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SignalEmitter</span>: <span class="keyword">public</span> cModule &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">simsignal_t</span> counterSignal;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">simsignal_t</span> nameSignal;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">long</span> messageCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleMessage</span><span class="params">(cMessage *msg)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">emit</span>(counterSignal, messageCounter);</span><br><span class="line">        messageCounter++;</span><br><span class="line">        <span class="built_in">emit</span>(nameSignal, msg-&gt;<span class="built_in">str</span>());</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">simsignal_t</span> SignalEmitter::counterSignal = <span class="built_in">registerSignal</span>(<span class="string">&quot;messageCounter&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">simsignal_t</span> SignalEmitter::nameSignal = <span class="built_in">registerSignal</span>(<span class="string">&quot;messageName&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>虽然很容易配置和发出信号，但信号反应的实现特别复杂包括一系列模板类代码。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module reacting to signals in plain OMNeT++ fashion, has to inherit from cListener or implement cIListener</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WithoutSignalCallbacks</span>: <span class="keyword">public</span> cModule, <span class="keyword">public</span> cListener &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// subscribe to the signal with itself as handler</span></span><br><span class="line">        <span class="built_in">subscribe</span>(SignalEmitter::counterSignal, <span class="keyword">this</span>);</span><br><span class="line">        <span class="built_in">subscribe</span>(SignalEmitter::nameSignal, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// signal handler for all signals with a long parameter</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">receiveSignal</span><span class="params">(cComponent* source, <span class="type">simsignal_t</span> signalID, <span class="type">long</span> l, cObject* details)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// identify signal to handle</span></span><br><span class="line">        <span class="keyword">if</span> (signalID == SignalEmitter::counterSignal) &#123;</span><br><span class="line">            <span class="comment">// react to signal</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Module &quot;</span> &lt;&lt; source-&gt;<span class="built_in">getFullName</span>() &lt;&lt; <span class="string">&quot; received message nr &quot;</span> &lt;&lt; l &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// signal handler for all signals with a string parameter</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">receiveSignal</span><span class="params">(cComponent* source, <span class="type">simsignal_t</span> signalID, <span class="type">const</span> <span class="type">char</span>* s, cObject* details)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// identify signal to handle</span></span><br><span class="line">        <span class="keyword">if</span> (signalID == SignalEmitter::nameSignal) &#123;</span><br><span class="line">            <span class="comment">// react to signal</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Module &quot;</span> &lt;&lt; source-&gt;<span class="built_in">getFullName</span>() &lt;&lt; <span class="string">&quot; received message with content &quot;</span> &lt;&lt; c &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="signalmanager">SignalManager</h2>
<p>使用 [SignalManager]，可以封装所有信号处理，并将配置保留在一个地方:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module reacting to signals using the SignalManager</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WithSignalManager</span>: <span class="keyword">public</span> cModule &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    veins::SignalManager signalManager;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// reaction to the signal</span></span><br><span class="line">        <span class="keyword">auto</span> nameSignalCallback = [<span class="keyword">this</span>](veins::SignalPayload&lt;<span class="type">const</span> <span class="type">char</span>*&gt; payload) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Module &quot;</span> &lt;&lt; payload.source-&gt;<span class="built_in">getFullName</span>() &lt;&lt; <span class="string">&quot; received message with content &quot;</span> &lt;&lt; payload.p &lt;&lt; std::endl;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">auto</span> counterSignalCallback = [<span class="keyword">this</span>](veins::SignalPayload&lt;<span class="type">long</span>&gt; payload) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Module &quot;</span> &lt;&lt; payload.source-&gt;<span class="built_in">getFullName</span>() &lt;&lt; <span class="string">&quot; received message nr &quot;</span> &lt;&lt; payload.p &lt;&lt; <span class="string">&quot; via signal &quot;</span> &lt;&lt; payload.signalID &lt;&lt; std::endl;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// register callbacks with the signal manager, which takes care to perform the actual subscription</span></span><br><span class="line">        signalManager.<span class="built_in">subscribeCallback</span>(<span class="built_in">getSystemModule</span>(), SignalEmitter::nameSignal, nameSignalCallback);</span><br><span class="line">        signalManager.<span class="built_in">subscribeCallback</span>(<span class="built_in">getSystemModule</span>(), SignalEmitter::counterSignal, counterSignalCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="signalcallbacklistener">SignalCallbackListener</h2>
<p>或者，我们可以省略 Manager 部分并为每个注册的回调创建单独的 [SignalCallbackListener] 对象：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module reacting to signals using the SignalCallback instances</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WithSignalCallbacks</span>: <span class="keyword">public</span> cModule &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    veins::SignalCallbackListener counterCallback;</span><br><span class="line">    veins::SignalCallbackListener nameCallback;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// reaction to the signal</span></span><br><span class="line">        <span class="keyword">auto</span> nameSignalCallback = [<span class="keyword">this</span>](veins::SignalPayload&lt;<span class="type">const</span> <span class="type">char</span>*&gt; payload) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Module &quot;</span> &lt;&lt; payload.source-&gt;<span class="built_in">getFullName</span>() &lt;&lt; <span class="string">&quot; received message with content &quot;</span> &lt;&lt; payload.p &lt;&lt; std::endl;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">auto</span> counterSignalCallback = [<span class="keyword">this</span>](veins::SignalPayload&lt;<span class="type">long</span>&gt; payload) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Module &quot;</span> &lt;&lt; payload.source-&gt;<span class="built_in">getFullName</span>() &lt;&lt; <span class="string">&quot; received message nr &quot;</span> &lt;&lt; payload.p &lt;&lt; <span class="string">&quot; via signal &quot;</span> &lt;&lt; payload.signalID &lt;&lt; std::endl;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// register callback objects, which takes care to perform the actual subscription</span></span><br><span class="line">        counterCallback = veins::<span class="built_in">SignalCallbackListener</span>(<span class="built_in">getSystemModule</span>(), SignalEmitter::counterSignal, counterSignalCallback);</span><br><span class="line">        nameCallback = veins::<span class="built_in">SignalCallbackListener</span>(<span class="built_in">getSystemModule</span>(), SignalEmitter::nameSignal, nameCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样可以更清楚地控制每个 SignalCallbackListener 实例的生命周期。</p>
<h2 id="common-features">Common Features</h2>
<p>使用 [SignalManager] 和 [SignalCallbackListener] 的话便无需自己实现 cIListener，生命周期是自动管理的，并且代码都保存在一个地方，除了 Lambda 还可以使用其他形式的回调例如仿函数。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://qiaoxu123.github.io">xqiao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://qiaoxu123.github.io/posts/Omnet-Veins/20220918-veins-omnet-simsignal-management.html">http://qiaoxu123.github.io/posts/Omnet-Veins/20220918-veins-omnet-simsignal-management.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">经验总结</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/Omnet-Veins/20220918-veins-analoguemodels.html" title="Veins Module 浅析1 -- AnalogueModels 的调用逻辑"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">Veins Module 浅析1 -- AnalogueModels 的调用逻辑</div></div></a></div><div class="next-post pull-right"><a href="/posts/System-development/20220622-windows-cmake-glog-error.html" title="Windows CMake 引用自编译 glog 库和 gflag 库报错问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">Windows CMake 引用自编译 glog 库和 gflag 库报错问题</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">xqiao</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" href="https://github.com/qiaoxu123"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/qiaoxu123" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:george.x.qiao@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">个人的技术小站，随性记录问题或整理学习。文章内容如有疑问请邮件联系，备注关键字博客，会尽力解答，有的时间太长已不再维护，望理解，谢谢！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#signalmanager"><span class="toc-text">SignalManager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#signalcallbacklistener"><span class="toc-text">SignalCallbackListener</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#common-features"><span class="toc-text">Common Features</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/FPGA/20240303-Optimization-of-for-loop-performance-metrics.html" title="HLS Learning P14 - Optimization of for-loop - Performance Metrics">HLS Learning P14 - Optimization of for-loop - Performance Metrics</a><time datetime="2024-03-02T16:00:00.000Z" title="Created 2024-03-03 00:00:00">2024-03-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/FPGA/20240301-Interface-Synthesis.html" title="HLS Learning P13 - Interface Synthesis">HLS Learning P13 - Interface Synthesis</a><time datetime="2024-02-29T16:00:00.000Z" title="Created 2024-03-01 00:00:00">2024-03-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/FPGA/20240229-Implementing-Arrays-as-RTL-Interfaces.html" title="HLS Learning P12 - Implementing Arrays as RTL Interfaces">HLS Learning P12 - Implementing Arrays as RTL Interfaces</a><time datetime="2024-02-28T16:00:00.000Z" title="Created 2024-02-29 00:00:00">2024-02-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/FPGA/20240227-Basic-Introduction-of-Interface-synthesis.html" title="HLS Learning P11 - Basic Introduction of Interface Synthesis">HLS Learning P11 - Basic Introduction of Interface Synthesis</a><time datetime="2024-02-26T16:00:00.000Z" title="Created 2024-02-27 00:00:00">2024-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/FPGA/20240218-Quartus-RTL-Analyzer.html" title="Quartus RTL Analyzer 使用笔记">Quartus RTL Analyzer 使用笔记</a><time datetime="2024-02-17T16:00:00.000Z" title="Created 2024-02-18 00:00:00">2024-02-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By xqiao</div><div class="framework-info"><span>Framework </span><a href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>